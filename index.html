// さっきの startGame 関数の中身をこう書き換えてください
function startGame(isAdmin) {
    const name = document.getElementById('player-name').value;
    if (!name) return alert("名前を入力してください");
    
    myPlayer.name = name;
    myPlayer.isAdmin = isAdmin;

    // ログイン画面を消してゲーム画面を出す
    document.getElementById('login-screen').style.display = 'none';
    initGame(); // ゲーム開始！
}

function initGame() {
    const config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        physics: { default: 'arcade', arcade: { gravity: { y: 0 } } },
        scene: { preload: preload, create: create, update: update }
    };

    const game = new Phaser.Game(config);
}

function preload() {
    // 飛行機の画像を読み込み（とりあえず三角で代用）
    this.load.image('ship', 'https://labs.phaser.io/assets/sprites/asteroids-ship.png');
}

let player;
let cursors;
let nameTag;

function create() {
    // マップの広さを設定 (3000x3000)
    this.cameras.main.setBounds(0, 0, 3000, 3000);
    this.physics.world.setBounds(0, 0, 3000, 3000);

    // プレイヤー作成
    player = this.physics.add.sprite(1500, 1500, 'ship');
    player.setCollideWorldBounds(true);
    player.setDrag(100);
    player.setAngularDrag(100);
    player.setMaxVelocity(300);

    // 名前を表示
    let displayName = myPlayer.name + (myPlayer.isAdmin ? " [管理者]" : "");
    nameTag = this.add.text(0, 0, displayName, { fontSize: '14px', fill: '#fff' });

    // カメラがプレイヤーを追いかける
    this.cameras.main.startFollow(player);

    cursors = this.input.keyboard.createCursorKeys();
}

function update() {
    // 操作：上キーで加速、左右で回転
    if (cursors.up.isDown) {
        this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
    } else {
        player.setAcceleration(0);
    }

    if (cursors.left.isDown) {
        player.setAngularVelocity(-200);
    } else if (cursors.right.isDown) {
        player.setAngularVelocity(200);
    } else {
        player.setAngularVelocity(0);
    }

    // 名前の位置をプレイヤーに合わせる
    nameTag.x = player.x - (nameTag.width / 2);
    nameTag.y = player.y - 40;
}
