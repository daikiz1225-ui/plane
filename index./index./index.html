<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Sky Wars Online</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { background: #222; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .login-box { background: #333; padding: 30px; border-radius: 10px; text-align: center; width: 300px; z-index: 10; }
        input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; }
        button { width: 100%; padding: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #admin-panel { display: none; margin-top: 10px; }
        canvas { position: absolute; top: 0; left: 0; }
    </style>
</head>
<body>

<div class="login-box" id="login-screen">
    <h2>Sky Wars</h2>
    <input type="text" id="player-name" placeholder="名前を入力" maxlength="10">
    <button onclick="startGame(false)">ゲーム開始</button>
    <div style="font-size:10px; color:#666; margin-top:10px; cursor:pointer;" onclick="document.getElementById('admin-panel').style.display='block'">管理者ログイン</div>
    <div id="admin-panel">
        <input type="password" id="admin-pass" placeholder="管理者コード">
        <button onclick="checkAdmin()">管理者ログイン</button>
    </div>
</div>

<script>
    // --- プレイヤーデータ ---
    let myPlayer = { name: "", isAdmin: false };
    let player;
    let cursors;
    let nameTag;

    // --- ログイン処理 ---
    function checkAdmin() {
        const pass = document.getElementById('admin-pass').value;
        if (pass === "122552213924") startGame(true);
        else alert("コードが違います");
    }

    function startGame(isAdmin) {
        const name = document.getElementById('player-name').value;
        if (!name) return alert("名前を入力してね");
        myPlayer.name = name;
        myPlayer.isAdmin = isAdmin;
        document.getElementById('login-screen').style.display = 'none';
        initGame();
    }

    // --- ゲーム本体 ---
    function initGame() {
        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight,
            physics: { default: 'arcade', arcade: { gravity: { y: 0 } } },
            scene: { preload: preload, create: create, update: update }
        };
        new Phaser.Game(config);
    }

    function preload() {
        // 飛行機の代わりの三角画像
        this.load.image('ship', 'https://labs.phaser.io/assets/sprites/asteroids-ship.png');
    }

    function create() {
        this.cameras.main.setBounds(0, 0, 3000, 3000);
        this.physics.world.setBounds(0, 0, 3000, 3000);

        player = this.physics.add.sprite(1500, 1500, 'ship');
        player.setCollideWorldBounds(true);
        player.setDrag(100);
        player.setAngularDrag(100);

        let displayName = myPlayer.name + (myPlayer.isAdmin ? " [管理者]" : "");
        nameTag = this.add.text(0, 0, displayName, { fontSize: '14px', fill: '#fff' });

        this.cameras.main.startFollow(player);
        cursors = this.input.keyboard.createCursorKeys();
    }

    function update() {
        if (!player) return;
        if (cursors.up.isDown) this.physics.velocityFromRotation(player.rotation, 300, player.body.acceleration);
        else player.setAcceleration(0);

        if (cursors.left.isDown) player.setAngularVelocity(-200);
        else if (cursors.right.isDown) player.setAngularVelocity(200);
        else player.setAngularVelocity(0);

        nameTag.x = player.x - (nameTag.width / 2);
        nameTag.y = player.y - 40;
    }
</script>
</body>
</html>
